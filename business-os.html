<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BusinessOS - Operations Suite</title>
<style>
/* --- PROFESSIONAL THEME --- */
:root {
    --bg-body: #f7f9fc;
    --bg-sidebar: #ffffff;
    --bg-card: #ffffff;
    
    --text-main: #1a202c;
    --text-muted: #718096;
    --text-light: #a0aec0;
    
    --border: #e2e8f0;
    --border-hover: #cbd5e0;
    
    --primary: #3182ce;
    --primary-dark: #2b6cb0;
    --success: #38a169;
    --danger: #e53e3e;
    --warning: #d69e2e;
    
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    
    --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
}

* { box-sizing: border-box; outline: none; }

body {
    margin: 0;
    font-family: var(--font-sans);
    color: var(--text-main);
    background: var(--bg-body);
    display: flex;
    height: 100vh;
    overflow: hidden;
    font-size: 14px;
}

/* --- SIDEBAR --- */
aside {
    width: 250px;
    background: var(--bg-sidebar);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    z-index: 10;
}

.brand {
    padding: 20px 24px;
    font-size: 18px;
    font-weight: 800;
    color: var(--text-main);
    display: flex;
    align-items: center;
    gap: 10px;
    letter-spacing: -0.5px;
}
.brand span { color: var(--primary); }

.nav { flex: 1; padding: 10px 12px; }
.nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 12px;
    color: var(--text-muted);
    font-weight: 500;
    border-radius: 6px;
    cursor: pointer;
    transition: 0.2s;
    margin-bottom: 4px;
}
.nav-item:hover { background: #f7fafc; color: var(--text-main); }
.nav-item.active { background: #ebf8ff; color: var(--primary); font-weight: 600; }

.foot {
    padding: 20px;
    border-top: 1px solid var(--border);
    font-size: 12px;
    color: var(--text-muted);
}
.foot a { color: var(--text-muted); text-decoration: none; border-bottom: 1px dotted var(--text-light); }

/* --- MAIN CONTENT --- */
main {
    flex: 1;
    overflow-y: auto;
    padding: 30px 40px;
    position: relative;
}

.view { display: none; max-width: 1000px; margin: 0 auto; animation: fadein 0.3s ease; }
.view.active { display: block; }
@keyframes fadein { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

/* --- UI COMPONENTS --- */
h1 { font-size: 28px; font-weight: 700; margin: 0 0 10px; color: var(--text-main); letter-spacing: -0.5px; }
h2 { font-size: 18px; font-weight: 600; margin: 20px 0 15px; border-bottom: 1px solid var(--border); padding-bottom: 8px; }
p.desc { color: var(--text-muted); margin-bottom: 24px; line-height: 1.5; }

.card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 24px;
    box-shadow: var(--shadow-sm);
    margin-bottom: 20px;
}

.btn {
    display: inline-flex; align-items: center; gap: 8px;
    padding: 8px 16px;
    border-radius: 6px;
    font-weight: 500;
    font-size: 14px;
    cursor: pointer;
    border: 1px solid transparent;
    transition: 0.2s;
}
.btn-primary { background: var(--primary); color: white; }
.btn-primary:hover { background: var(--primary-dark); }
.btn-outline { background: white; border-color: var(--border); color: var(--text-main); }
.btn-outline:hover { border-color: var(--border-hover); background: #f7fafc; }
.btn-sm { padding: 4px 10px; font-size: 12px; }

input, select, textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-family: inherit;
    font-size: 14px;
    color: var(--text-main);
    background: white;
    transition: 0.2s;
}
input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(66,153,225,0.15); }

/* --- CRM TABLES --- */
table { width: 100%; border-collapse: collapse; }
th { text-align: left; padding: 12px 16px; color: var(--text-muted); font-size: 12px; text-transform: uppercase; font-weight: 600; border-bottom: 1px solid var(--border); }
td { padding: 12px 16px; border-bottom: 1px solid var(--border); vertical-align: middle; }
tr:last-child td { border-bottom: none; }
.status-pill { padding: 2px 8px; border-radius: 99px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
.st-lead { background: #ebf8ff; color: var(--primary); }
.st-active { background: #f0fff4; color: var(--success); }
.st-closed { background: #edf2f7; color: var(--text-muted); }

/* --- INVOICE PAPER (PRINT LOGIC) --- */
#invoice-paper {
    background: white;
    width: 210mm;
    min-height: 297mm;
    padding: 20mm;
    margin: 0 auto;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    display: none; /* Hidden by default in editor mode */
    color: #000;
}
.inv-grid { display: grid; grid-template-columns: 1fr 1fr; margin-bottom: 40px; }
.inv-total { text-align: right; margin-top: 30px; font-size: 16px; }
.inv-total span { font-weight: bold; font-size: 24px; margin-left: 10px; }
@media print {
    body { background: white; }
    aside, .no-print, .card, h1, .desc { display: none !important; }
    #invoice-app { display: block; }
    #invoice-paper { display: block; box-shadow: none; margin: 0; width: 100%; }
    main { padding: 0; overflow: visible; }
    .view { max-width: none; }
}

/* --- CALCULATOR --- */
.calc-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dotted var(--border); }
.calc-val { font-weight: 700; font-family: monospace; font-size: 16px; }
.big-price { font-size: 32px; color: var(--primary); font-weight: 800; text-align: center; margin: 20px 0; }

</style>
</head>
<body>

<aside>
    <div class="brand">
        <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" style="color:var(--primary)"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>
        BusinessOS
    </div>
    
    <div class="nav">
        <div class="nav-item active" onclick="nav('crm')">
            <span>üë•</span> Client CRM
        </div>
        <div class="nav-item" onclick="nav('invoice')">
            <span>üìÑ</span> Invoicing
        </div>
        <div class="nav-item" onclick="nav('expense')">
            <span>üí∏</span> Expenses
        </div>
        <div class="nav-item" onclick="nav('pricing')">
            <span>üè∑Ô∏è</span> Pricing Calc
        </div>
        <div class="nav-item" onclick="nav('contracts')">
            <span>‚úíÔ∏è</span> Contracts
        </div>
    </div>

    <div class="foot">
        Made with &hearts; by <a href="https://www.mehranshahmiri.com" target="_blank">Mehran Shahmiri</a>
    </div>
</aside>

<main>

    <!-- 1. CRM -->
    <div id="crm" class="view active">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h1>Client Tracker</h1>
            <button class="btn btn-primary" onclick="showClientModal()">+ New Client</button>
        </div>
        <p class="desc">Manage relationships, status, and contact details.</p>

        <div class="card" style="padding:0; overflow:hidden;">
            <table id="client-table">
                <thead><tr><th>Name</th><th>Company</th><th>Email</th><th>Status</th><th style="text-align:right">Action</th></tr></thead>
                <tbody id="client-list"></tbody>
            </table>
        </div>
        
        <!-- Add Client Modal (Simulated in card) -->
        <div id="client-form" class="card" style="display:none; border: 1px solid var(--primary);">
            <h3>Add / Edit Client</h3>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:15px;">
                <input id="c-name" placeholder="Full Name">
                <input id="c-comp" placeholder="Company Name">
                <input id="c-email" placeholder="Email Address">
                <select id="c-status">
                    <option value="Lead">Lead</option>
                    <option value="Active">Active</option>
                    <option value="Closed">Closed</option>
                </select>
            </div>
            <textarea id="c-notes" placeholder="Notes..." style="margin-bottom:15px;"></textarea>
            <button class="btn btn-primary" onclick="saveClient()">Save Client</button>
            <button class="btn btn-outline" onclick="document.getElementById('client-form').style.display='none'">Cancel</button>
        </div>
    </div>

    <!-- 2. INVOICE GENERATOR -->
    <div id="invoice" class="view">
        <div class="no-print">
            <h1>Invoice Generator</h1>
            <p class="desc">Fill details, click print to generate PDF.</p>
            
            <div class="card">
                <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:15px; margin-bottom:20px;">
                    <input id="inv-num" placeholder="Invoice #" value="INV-001" oninput="renderInvoice()">
                    <input type="date" id="inv-date" oninput="renderInvoice()">
                    <input type="date" id="inv-due" oninput="renderInvoice()">
                </div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:20px;">
                    <textarea id="inv-from" placeholder="Your Business Info" rows="3" oninput="renderInvoice()">My Business Inc.&#10;123 Biz Street&#10;City, Country</textarea>
                    <textarea id="inv-to" placeholder="Client Info" rows="3" oninput="renderInvoice()"></textarea>
                </div>
                
                <h3>Items</h3>
                <div id="inv-items-input"></div>
                <button class="btn btn-outline btn-sm" onclick="addInvItem()">+ Add Item</button>
                
                <div style="margin-top:20px; text-align:right;">
                    <button class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Print / Save PDF</button>
                </div>
            </div>
        </div>

        <!-- PRINTABLE PAPER AREA -->
        <div id="invoice-paper">
            <div style="display:flex; justify-content:space-between; margin-bottom:40px;">
                <h1 style="color:var(--text-main)">INVOICE</h1>
                <div style="text-align:right; color:var(--text-muted);">
                    <div id="p-inv-num" style="font-weight:bold; color:var(--text-main)"></div>
                    <div id="p-inv-date"></div>
                </div>
            </div>

            <div class="inv-grid">
                <div>
                    <strong>FROM:</strong>
                    <div id="p-inv-from" style="white-space:pre-wrap;"></div>
                </div>
                <div>
                    <strong>TO:</strong>
                    <div id="p-inv-to" style="white-space:pre-wrap;"></div>
                </div>
            </div>

            <table style="width:100%; margin-top:20px; border-top:2px solid #000;">
                <thead style="border-bottom:1px solid #ccc;">
                    <tr><th style="color:#000; padding-left:0;">Description</th><th style="text-align:right">Qty</th><th style="text-align:right">Price</th><th style="text-align:right; padding-right:0;">Total</th></tr>
                </thead>
                <tbody id="p-inv-items"></tbody>
            </table>

            <div class="inv-total">
                Total Due: <span id="p-inv-total">$0.00</span>
            </div>
            
            <div style="margin-top:50px; border-top:1px solid #eee; padding-top:20px; color:var(--text-muted); font-size:12px;">
                Thank you for your business. Payment is due within 30 days.
            </div>
        </div>
    </div>

    <!-- 3. EXPENSE SPLITTER -->
    <div id="expense" class="view">
        <h1>Expense Splitter</h1>
        <p class="desc">Track shared costs and calculate who owes whom.</p>

        <div style="display:grid; grid-template-columns: 2fr 1fr; gap:20px;">
            <div class="card">
                <h3>Transactions</h3>
                <div style="display:flex; gap:10px; margin-bottom:15px;">
                    <input id="exp-who" placeholder="Who paid? (e.g. Alice)" style="flex:1">
                    <input id="exp-what" placeholder="For what?" style="flex:2">
                    <input type="number" id="exp-amt" placeholder="Amount" style="width:100px;">
                    <button class="btn btn-primary" onclick="addExpense()">Add</button>
                </div>
                <table id="exp-table">
                    <thead><tr><th>Payer</th><th>Description</th><th>Amount</th><th>Action</th></tr></thead>
                    <tbody id="exp-list"></tbody>
                </table>
            </div>

            <div class="card" style="background:#ebf8ff; border-color:#bee3f8;">
                <h3 style="color:#2b6cb0">Settlement</h3>
                <div id="exp-result" style="font-size:14px; line-height:1.6;">Add expenses to see who owes whom.</div>
                <button class="btn btn-outline btn-sm" style="margin-top:10px; width:100%;" onclick="calcSplit()">Recalculate</button>
            </div>
        </div>
    </div>

    <!-- 4. PRICING CALCULATOR -->
    <div id="pricing" class="view">
        <h1>Pricing Calculator</h1>
        <p class="desc">Cost-plus pricing model generator.</p>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:30px;">
            <div class="card">
                <h3>Inputs</h3>
                <label style="font-size:12px; font-weight:bold; color:var(--text-muted);">Direct Costs ($)</label>
                <input type="number" id="pr-cost" placeholder="Materials, Software, etc." oninput="calcPrice()">
                
                <label style="font-size:12px; font-weight:bold; color:var(--text-muted); display:block; margin-top:10px;">Labor Hours</label>
                <input type="number" id="pr-hours" placeholder="Hours" oninput="calcPrice()">
                
                <label style="font-size:12px; font-weight:bold; color:var(--text-muted); display:block; margin-top:10px;">Hourly Rate ($)</label>
                <input type="number" id="pr-rate" placeholder="Your rate" value="50" oninput="calcPrice()">
                
                <label style="font-size:12px; font-weight:bold; color:var(--text-muted); display:block; margin-top:10px;">Desired Margin (%)</label>
                <input type="number" id="pr-margin" placeholder="Profit margin" value="20" oninput="calcPrice()">
            </div>
            
            <div class="card" style="text-align:center; display:flex; flex-direction:column; justify-content:center;">
                <div style="color:var(--text-muted); text-transform:uppercase; letter-spacing:1px; font-size:12px; font-weight:bold;">Suggested Price</div>
                <div class="big-price" id="pr-final">$0.00</div>
                
                <div style="margin-top:20px; text-align:left;">
                    <div class="calc-row"><span>Total Cost:</span> <span id="pr-total-cost" class="calc-val">$0.00</span></div>
                    <div class="calc-row"><span>Profit:</span> <span id="pr-profit" class="calc-val" style="color:var(--success)">$0.00</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 5. CONTRACT CHECKLIST -->
    <div id="contracts" class="view">
        <h1>Contract Checklist</h1>
        <p class="desc">Ensure your agreements cover the essentials.</p>

        <div class="card">
            <h3>Standard Clauses</h3>
            <div id="clause-list" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:15px;">
                <!-- JS Generated -->
            </div>
            
            <div style="margin-top:20px; border-top:1px solid var(--border); padding-top:20px;">
                <button class="btn btn-primary" onclick="generateChecklist()">Export Text</button>
                <textarea id="contract-out" rows="10" style="margin-top:15px; display:none;"></textarea>
            </div>
        </div>
    </div>

</main>

<script>
    // --- DB & STATE ---
    const DB = {
        get: (k, d) => JSON.parse(localStorage.getItem('biz_'+k) || JSON.stringify(d)),
        set: (k, v) => localStorage.setItem('biz_'+k, JSON.stringify(v))
    };

    function nav(id) {
        document.querySelectorAll('.view').forEach(e => e.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
        event.currentTarget.classList.add('active');
    }

    function formatMoney(n) { return '$' + parseFloat(n).toFixed(2); }

    // --- 1. CRM ---
    function renderClients() {
        const list = DB.get('clients', []);
        const html = list.map((c, i) => `
            <tr>
                <td><b>${c.name}</b></td>
                <td>${c.comp}</td>
                <td>${c.email}</td>
                <td><span class="status-pill st-${c.status.toLowerCase()}">${c.status}</span></td>
                <td style="text-align:right">
                    <button class="btn btn-outline btn-sm" onclick="delClient(${i})">Delete</button>
                </td>
            </tr>
        `).join('');
        document.getElementById('client-list').innerHTML = html || '<tr><td colspan="5" style="text-align:center; padding:20px; color:#aaa">No clients found.</td></tr>';
    }

    function showClientModal() { document.getElementById('client-form').style.display = 'block'; }
    
    function saveClient() {
        const c = {
            name: document.getElementById('c-name').value,
            comp: document.getElementById('c-comp').value,
            email: document.getElementById('c-email').value,
            status: document.getElementById('c-status').value,
            notes: document.getElementById('c-notes').value
        };
        if(c.name) {
            const list = DB.get('clients', []);
            list.push(c);
            DB.set('clients', list);
            document.getElementById('client-form').style.display = 'none';
            // Clear inputs
            document.getElementById('c-name').value = ''; 
            renderClients();
        }
    }

    function delClient(i) {
        if(confirm("Remove client?")) {
            const list = DB.get('clients', []);
            list.splice(i, 1);
            DB.set('clients', list);
            renderClients();
        }
    }

    // --- 2. INVOICE ---
    let invItems = [{desc: 'Service Fee', qty: 1, price: 100}];
    
    function renderInvInputs() {
        const html = invItems.map((item, i) => `
            <div style="display:grid; grid-template-columns: 3fr 1fr 1fr auto; gap:10px; margin-bottom:10px;">
                <input placeholder="Description" value="${item.desc}" oninput="updInvItem(${i}, 'desc', this.value)">
                <input type="number" placeholder="Qty" value="${item.qty}" oninput="updInvItem(${i}, 'qty', this.value)">
                <input type="number" placeholder="Price" value="${item.price}" oninput="updInvItem(${i}, 'price', this.value)">
                <button class="btn btn-outline" onclick="delInvItem(${i})">√ó</button>
            </div>
        `).join('');
        document.getElementById('inv-items-input').innerHTML = html;
        renderInvoice();
    }
    
    function updInvItem(i, k, v) { invItems[i][k] = v; renderInvoice(); }
    function addInvItem() { invItems.push({desc:'', qty:1, price:0}); renderInvInputs(); }
    function delInvItem(i) { invItems.splice(i, 1); renderInvInputs(); }
    
    function renderInvoice() {
        // Paper Render
        document.getElementById('p-inv-num').innerText = document.getElementById('inv-num').value;
        document.getElementById('p-inv-date').innerText = document.getElementById('inv-date').value;
        document.getElementById('p-inv-from').innerText = document.getElementById('inv-from').value;
        document.getElementById('p-inv-to').innerText = document.getElementById('inv-to').value;
        
        let total = 0;
        const rows = invItems.map(item => {
            const lineTotal = item.qty * item.price;
            total += lineTotal;
            return `
                <tr>
                    <td style="padding-left:0; color:#000;">${item.desc}</td>
                    <td style="text-align:right">${item.qty}</td>
                    <td style="text-align:right">${formatMoney(item.price)}</td>
                    <td style="text-align:right; font-weight:bold; padding-right:0;">${formatMoney(lineTotal)}</td>
                </tr>
            `;
        }).join('');
        
        document.getElementById('p-inv-items').innerHTML = rows;
        document.getElementById('p-inv-total').innerText = formatMoney(total);
    }

    // --- 3. EXPENSES ---
    function renderExpenses() {
        const list = DB.get('expenses', []);
        const html = list.map((e, i) => `
            <tr>
                <td><b>${e.who}</b></td>
                <td>${e.what}</td>
                <td>${formatMoney(e.amt)}</td>
                <td><button class="btn btn-outline btn-sm" onclick="delExp(${i})">√ó</button></td>
            </tr>
        `).join('');
        document.getElementById('exp-list').innerHTML = html;
        calcSplit();
    }
    
    function addExpense() {
        const who = document.getElementById('exp-who').value;
        const what = document.getElementById('exp-what').value;
        const amt = parseFloat(document.getElementById('exp-amt').value);
        if(who && amt) {
            const list = DB.get('expenses', []);
            list.push({who, what, amt});
            DB.set('expenses', list);
            document.getElementById('exp-what').value = '';
            document.getElementById('exp-amt').value = '';
            renderExpenses();
        }
    }
    
    function delExp(i) {
        const list = DB.get('expenses', []);
        list.splice(i, 1);
        DB.set('expenses', list);
        renderExpenses();
    }
    
    function calcSplit() {
        const list = DB.get('expenses', []);
        if(list.length === 0) { document.getElementById('exp-result').innerText = 'No data.'; return; }
        
        const balances = {};
        let total = 0;
        
        list.forEach(e => {
            if(!balances[e.who]) balances[e.who] = 0;
            balances[e.who] += e.amt;
            total += e.amt;
        });
        
        const people = Object.keys(balances);
        const split = total / people.length;
        
        let report = `Total Spent: <b>${formatMoney(total)}</b><br>Split per person: <b>${formatMoney(split)}</b><br><br>`;
        
        people.forEach(p => {
            const diff = balances[p] - split;
            const color = diff >= 0 ? 'green' : 'red';
            const action = diff >= 0 ? 'is owed' : 'owes';
            report += `<div>${p} paid ${formatMoney(balances[p])} (${action} <span style="color:${color}; font-weight:bold">${formatMoney(Math.abs(diff))}</span>)</div>`;
        });
        
        document.getElementById('exp-result').innerHTML = report;
    }

    // --- 4. PRICING ---
    function calcPrice() {
        const cost = parseFloat(document.getElementById('pr-cost').value) || 0;
        const hrs = parseFloat(document.getElementById('pr-hours').value) || 0;
        const rate = parseFloat(document.getElementById('pr-rate').value) || 0;
        const margin = parseFloat(document.getElementById('pr-margin').value) || 0;
        
        const laborCost = hrs * rate;
        const totalCost = cost + laborCost;
        
        // Price = Cost / (1 - Margin%)
        let price = 0;
        if(margin < 100) {
            price = totalCost / (1 - (margin/100));
        }
        
        const profit = price - totalCost;
        
        document.getElementById('pr-final').innerText = formatMoney(price);
        document.getElementById('pr-total-cost').innerText = formatMoney(totalCost);
        document.getElementById('pr-profit').innerText = formatMoney(profit);
    }

    // --- 5. CONTRACTS ---
    const clauses = [
        "Scope of Work Definition",
        "Payment Terms & Schedule",
        "Timeline & Milestones",
        "Revisions & Edits Policy",
        "Termination Clause",
        "Intellectual Property Rights",
        "Confidentiality (NDA)",
        "Liability Limitations",
        "Dispute Resolution"
    ];
    
    function renderClauses() {
        const html = clauses.map(c => `
            <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
                <input type="checkbox" value="${c}" checked style="width:auto;"> ${c}
            </label>
        `).join('');
        document.getElementById('clause-list').innerHTML = html;
    }
    
    function generateChecklist() {
        const checks = document.querySelectorAll('#clause-list input:checked');
        let text = "CONTRACT CHECKLIST:\n===================\n\n";
        checks.forEach(c => text += `[ ] ${c.value}\n`);
        
        const area = document.getElementById('contract-out');
        area.value = text;
        area.style.display = 'block';
        area.select();
    }

    // --- INIT ---
    renderClients();
    renderInvInputs();
    renderExpenses();
    renderClauses();
    
    // Set default dates
    document.getElementById('inv-date').valueAsDate = new Date();

</script>
</body>
</html>
